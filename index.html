<!DOCTYPE html>
<html lang="fa">
<head>
  <meta charset="UTF-8">
  <title>Ø¨Ø§Ø²ÛŒ Ø³Ù‡ Ù…Ø±Ø­Ù„Ù‡â€ŒØ§ÛŒ</title>
  <style>
    body {
      background-color: #111827;
      color: #f3f4f6;
      font-family: Tahoma, sans-serif;
      display: flex;
      flex-direction: column;
      align-items: center;
      min-height: 100vh;
      margin: 0;
      direction: rtl;
      padding: 10px;
      touch-action: none;
    }

    /* Progress emojis */
    .emoji-progress {
      display: flex;
      gap: 8px;
      margin: 10px 0;
    }
    .emoji-box {
      width: 36px;
      height: 36px;
      font-size: 20px;
      background: #1f2937;
      border-radius: 6px;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    .emoji-box.revealed {
      background: #16a34a;
      color: #fff;
      animation: glow 1s ease infinite alternate;
    }
    @keyframes glow {
      from { box-shadow: 0 0 4px #22c55e; }
      to   { box-shadow: 0 0 10px #22c55e; }
    }

    /* Main container */
    .container {
      background: #1f2937;
      padding: 16px;
      border-radius: 10px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.4);
      width: 100%;
      max-width: 420px;
      text-align: center;
      margin: 8px 0;
    }

    input, button {
      width: 100%;
      padding: 10px;
      margin: 6px 0;
      font-size: 15px;
      border-radius: 8px;
    }

    input {
      border: 1px solid #374151;
      background: #1f2937;
      color: #f3f4f6;
    }

    button {
      background: #3b82f6;
      border: none;
      color: white;
      cursor: pointer;
    }
    button:hover { background: #2563eb; }

    #hintBtn {
      width: 48px;
      height: 48px;
      font-size: 22px;
      border-radius: 8px;
      padding: 0;
    }

    #skipBtn {
      background: #f59e0b;
      margin-top: 6px;
    }

    #error { color: #f87171; font-size: 13px; margin-top: 6px; }
    #success { color: #4ade80; font-size: 14px; margin-top: 6px; }

    /* Memory game */
    #memory-grid {
      display: grid;
      grid-template-columns: repeat(5, 1fr);
      gap: 6px;
      justify-content: center;
      margin-top: 10px;
    }
    .card {
      aspect-ratio: 1;
      background: #374151;
      border-radius: 6px;
      font-size: 26px;
      color: transparent;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    .card.flipped { background: #4b5563; color: #f9fafb; }
    .card.matched { background: #10b981; color: #f9fafb; }
    .card.unique { background: #7c3aed; box-shadow: 0 0 6px 3px #facc15; }

    /* Maze */
    #maze {
      display: grid;
      grid-template-columns: repeat(7, minmax(28px, 1fr));
      grid-template-rows: repeat(7, minmax(28px, 1fr));
      gap: 2px;
      justify-content: center;
      margin: 15px auto;
      max-width: 95vw;
    }
    .maze-cell {
      background: #374151;
      border-radius: 4px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 16px;
    }
    .wall { background: #111827; }
    .player { background: #2563eb; color: #fff; }
    .goal { background: #10b981; }

    @media (min-width: 480px) {
      .emoji-box { width: 40px; height: 40px; font-size: 24px; }
      .card { font-size: 32px; }
      #maze { gap: 3px; }
      .maze-cell { font-size: 20px; }
    }
  </style>
</head>
<body>

<div class="emoji-progress">
  <div class="emoji-box" id="box1">â“</div>
  <div class="emoji-box" id="box2">â“</div>
  <div class="emoji-box" id="box3">â“</div>
</div>

<!-- Phase 1 -->
<div class="container" id="phase1">
  <h2>Ù…Ø±Ø­Ù„Ù‡ Ø§ÙˆÙ„</h2>
  <div id="question" style="margin-bottom: 8px;"></div>
  <div id="blank-line" style="font-size: 20px; margin-bottom: 10px; letter-spacing: 3px;"></div>
  <input id="answerInput" />
  <button onclick="checkAnswer()">Ø§Ø±Ø³Ø§Ù„</button>
  <button id="hintBtn" onclick="showHint()">ğŸ’¡</button>
  <button id="skipBtn" onclick="skipPhase(1)">â­ Ø±Ø¯ Ø´Ø¯Ù†</button>
  <div id="error"></div>
  <div id="success"></div>
</div>

<!-- Phase 2 -->
<div class="container" id="phase2" style="display: none;">
  <h2>Ù…Ø±Ø­Ù„Ù‡ Ø¯ÙˆÙ…</h2>
  <p style="font-size:13px;color:#9ca3af;">Ú©Ø§Ø±Øªâ€ŒÙ‡Ø§ÛŒ Ù…Ø´Ø§Ø¨Ù‡ Ø±Ùˆ Ù¾ÛŒØ¯Ø§ Ú©Ù†</p>
  <div id="memory-grid"></div>
  <button id="skipBtn" onclick="skipPhase(2)">â­ Ø±Ø¯ Ø´Ø¯Ù†</button>
</div>

<!-- Phase 3 -->
<div class="container" id="phase3" style="display: none;">
  <h2>Ù…Ø±Ø­Ù„Ù‡ Ø³ÙˆÙ…</h2>
  <p style="font-size:13px;color:#9ca3af;">Ø¨Ø§ Ú©Ø´ÛŒØ¯Ù† Ø§Ù†Ú¯Ø´Øª Ø§Ø² âœï¸ Ø¨Ù‡ ğŸ““ Ø¨Ø±Ø³</p>
  <div id="maze"></div>
  <button id="skipBtn" onclick="skipPhase(3)">â­ Ø±Ø¯ Ø´Ø¯Ù†</button>
</div>

<script>
  // ========= Helper =========
  function revealBox(n, emoji) {
    const box = document.getElementById(`box${n}`);
    box.innerText = emoji;
    box.classList.add("revealed");
  }

  function skipPhase(phase) {
    if (phase === 1) {
      document.getElementById("phase1").style.display = "none";
      revealBox(1,"ğŸ“¿");
      startMemoryGame();
    }
    if (phase === 2) {
      document.getElementById("phase2").style.display = "none";
      revealBox(2,"ğŸ§");
      startMaze();
    }
    if (phase === 3) {
      revealBox(3,"âœï¸ğŸ““");
      alert("ğŸ‰ ØªØ¨Ø±ÛŒÚ©! Ù‡Ù…Ù‡ Ù…Ø±Ø§Ø­Ù„ Ø±Ùˆ ØªÙ…ÙˆÙ… Ú©Ø±Ø¯ÛŒ");
    }
  }

  // ========= Phase 1 =========
  const stages = [
    { question: "ØªÙˆ .... ØªØ±ÛŒÙ† Ø¢Ø¯Ù…ÛŒ Ù‡Ø³ØªÛŒ Ú©Ù‡ ØªÙˆÛŒ Ø¹Ù…Ø±Ù… Ø¯ÛŒØ¯Ù….", answer: "Ø¢Ø´Ù†Ø§" },
    { question: "ØªÙˆ Ù†Ø¨Ø§ÛŒØ¯ Ù†Ø§Ø±Ø§Ø­Øª Ø¨Ø§Ø´ÛŒ Ú†ÙˆÙ† ØªÙˆ ÛŒÚ© .... ......", answer: "Ø®Ø±Ø³ Ù¾Ø´Ù…Ø§Ù„ÙˆÛŒÛŒ" },
    { question: "- Ø¸Ø§Ù‡Ø±Ù…Ù… ØªØ±Ø³Ù†Ø§Ú©Ù‡ØŸ +ÛŒÚ©Ù…Ù… .....", answer: "Ø®Ù†Ú¯ÛŒÙ†" },
    { question: "Ø§Ø³Ù…Øª ØªÙˆ Ú¯ÙˆØ´ÛŒ Ù…Ù† Ú†ÛŒ Ø³ÛŒÙˆÙ‡ØŸ  .....Ù Ù…Ù†.", answer: "Ù…Ø±ÙˆØ§Ø±ÛŒØ¯" }
  ];
  let currentStage = 0;

  function renderBlankLines(word) {
    const blankDiv = document.getElementById("blank-line");
    blankDiv.innerHTML = word.split("").map(ch => (ch===" "?"â€ƒ":"Ù€Ù€")).join(" ");
  }

  function loadStage() {
    const q = stages[currentStage];
    document.getElementById("question").innerText = q.question;
    document.getElementById("answerInput").value = "";
    document.getElementById("error").innerText = "";
    document.getElementById("success").innerText = "";
    renderBlankLines(q.answer);
  }

  function checkAnswer() {
    const input = document.getElementById("answerInput").value.trim().toLowerCase();
    const correct = stages[currentStage].answer.toLowerCase();
    if (input === correct) {
      document.getElementById("success").innerText = "âœ… Ø¯Ø±Ø³Øª Ø¨ÙˆØ¯";
      setTimeout(() => {
        currentStage++;
        if (currentStage < stages.length) loadStage();
        else skipPhase(1);
      }, 700);
    } else {
      document.getElementById("error").innerText = "âŒ Ù†Ù‡ Ø¹Ø²ÛŒØ²Ù…ØŒ Ø¯ÙˆØ¨Ø§Ø±Ù‡ Ø§Ù…ØªØ­Ø§Ù† Ú©Ù†.";
    }
  }
  function showHint() {
    const answer = stages[currentStage].answer;
    document.getElementById("answerInput").value = answer[0] || "";
  }
  loadStage();

  // ========= Phase 2 (Memory) =========
  let flippedCards = [], matchedCount = 0;
  function startMemoryGame() {
    document.getElementById("phase2").style.display = "block";
    const emojiPairs = ['ğŸ','ğŸ¶','ğŸš—','ğŸ•','ğŸŒ¸','ğŸ±','ğŸˆ','ğŸ§¸','ğŸŒ','ğŸ“š','ğŸ§ƒ','ğŸ§¦']; 
    const uniqueEmoji = 'ğŸ§';
    let allCards = [...emojiPairs, ...emojiPairs];
    allCards.push(uniqueEmoji);
    allCards = allCards.sort(()=>Math.random()-0.5);
    const grid = document.getElementById("memory-grid");
    grid.innerHTML="";
    flippedCards=[]; matchedCount=0;
    allCards.forEach(emoji=>{
      const card=document.createElement("div");
      card.className="card";
      card.dataset.emoji=emoji;
      card.onclick=()=>flipCard(card);
      grid.appendChild(card);
    });
  }
  function flipCard(card) {
    if (card.classList.contains("flipped")||card.classList.contains("matched")) return;
    card.classList.add("flipped");
    card.innerText=card.dataset.emoji;
    flippedCards.push(card);
    if (flippedCards.length===2) {
      const [f,s]=flippedCards;
      if (f.dataset.emoji===s.dataset.emoji) {
        f.classList.add("matched"); s.classList.add("matched");
        flippedCards=[]; matchedCount++;
        if (matchedCount===12) {
          setTimeout(()=>skipPhase(2),800);
        }
      } else {
        setTimeout(()=>{
          f.classList.remove("flipped"); s.classList.remove("flipped");
          f.innerText=""; s.innerText="";
          flippedCards=[];
        },700);
      }
    }
  }

  // ========= Phase 3 (Maze) =========
  const mazeLayout = [
    "#######",
    "#S....#",
    "###.#.#",
    "#.....#",
    "#.###.#",
    "#...G.#",
    "#######"
  ];
  let playerPos={x:1,y:1};
  function startMaze() {
    document.getElementById("phase3").style.display="block";
    drawMaze(); enableSwipe();
  }
  function drawMaze() {
    const maze=document.getElementById("maze");
    maze.innerHTML="";
    mazeLayout.forEach((row,y)=>{
      row.split("").forEach((cell,x)=>{
        const div=document.createElement("div");
        div.className="maze-cell";
        if(cell==="#")div.classList.add("wall");
        if(x===playerPos.x&&y===playerPos.y){div.classList.add("player");div.innerText="âœï¸";}
        else if(cell==="G"){div.classList.add("goal");div.innerText="ğŸ““";}
        maze.appendChild(div);
      });
    });
  }
  function movePlayer(dx,dy){
    const nx=playerPos.x+dx, ny=playerPos.y+dy;
    if(mazeLayout[ny][nx]!=="#"){playerPos={x:nx,y:ny};drawMaze();
      if(mazeLayout[ny][nx]==="G"){skipPhase(3);}
    }
  }
  function enableSwipe(){
    let sx,sy;
    const maze=document.getElementById("maze");
    maze.addEventListener("touchstart",e=>{
      const t=e.changedTouches[0]; sx=t.clientX; sy=t.clientY;
    });
    maze.addEventListener("touchend",e=>{
      const t=e.changedTouches[0];
      const dx=t.clientX-sx, dy=t.clientY-sy;
      if(Math.abs(dx)>Math.abs(dy)){
        if(dx>25) movePlayer(1,0); else if(dx<-25) movePlayer(-1,0);
      } else {
        if(dy>25) movePlayer(0,1); else if(dy<-25) movePlayer(0,-1);
      }
    });
  }
</script>

</body>
</html>
